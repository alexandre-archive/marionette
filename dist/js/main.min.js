function MarionetteDrawer(){function e(e){if(e.morphColors&&e.morphColors.length)for(var t=e.morphColors[0],n=0;n<t.colors.length;n++)e.faces[n].color=t.colors[n],e.faces[n].color.offsetHSL(0,.3,0)}function t(){if(o&&!i){var e=Date.now();for(var t in o)o[t].update?o[t].update(e-r):o[t].updateAnimation(e-r);r=e}_self.renderer.autoClear=!1,_self.renderer.clear(),_self.renderer.setViewport(0,0,window.innerWidth,window.innerHeight),_self.renderer.render(_self.backgroundScene,_self.backgroundCamera),_self.renderer.render(_self.scene,_self.camera)}{var n={},o={},i=!1,r=Date.now();new THREE.Clock}_self=this,this.setup=function(){var e=new THREE.Scene,t=new THREE.WebGLRenderer({alpha:!0,antialias:!0});t.setClearColor(0,0),t.setSize(window.innerWidth,window.innerHeight),t.domElement.style.position="fixed",t.domElement.style.top=0,t.domElement.style.left=0,t.domElement.style.width="100%",t.domElement.style.height="100%",document.body.appendChild(t.domElement);var n=new THREE.DirectionalLight(16777215,1);n.position.set(0,.5,1),e.add(n);var o=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,1e3);o.position.set(0,300,500),o.lookAt(new THREE.Vector3(0,160,0)),listener=new THREE.AudioListener,o.add(listener),window.addEventListener("resize",function(){o.aspect=window.innerWidth/window.innerHeight,o.updateProjectionMatrix(),t.setSize(window.innerWidth,window.innerHeight),t.render(e,o)},!1),e.add(o),this.scene=e,this.renderer=t,this.camera=o},this.setBackground=function(e){"undefined"==typeof e&&(e="images/country.png");var t=new THREE.MeshLambertMaterial({map:THREE.ImageUtils.loadTexture(e)}),n=new THREE.PlaneBufferGeometry(window.innerWidth,window.innerHeight),o=new THREE.Mesh(n,t);o.material.depthTest=!1,o.material.depthWrite=!1;var i=new THREE.Scene,r=new THREE.DirectionalLight(15724543,2);r.position.set(1,1,1).normalize(),i.add(r);var a=new THREE.DirectionalLight(16773103,2);a.position.set(-1,-1,-1).normalize(),i.add(a);var s=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,500);s.position.set(0,300,300),s.lookAt(new THREE.Vector3(0,160,0)),i.add(s),i.add(o),this.backgroundCamera=s,this.backgroundScene=i},this.addCube=function(e){var t=[];t.push(new THREE.MeshBasicMaterial({color:16724787})),t.push(new THREE.MeshBasicMaterial({color:16746496})),t.push(new THREE.MeshBasicMaterial({color:16777011})),t.push(new THREE.MeshBasicMaterial({color:3407667})),t.push(new THREE.MeshBasicMaterial({color:3355647})),t.push(new THREE.MeshBasicMaterial({color:8926207}));var o=new THREE.MeshFaceMaterial(t),i=new THREE.CubeGeometry(100,100,100,1,1,1);cube=new THREE.Mesh(i,o),cube.position.set(0,0,0),_self.scene.add(cube),n[e]=cube},this.addHorse=function(e,t,i,r){var a=new THREE.JSONLoader(!0);a.load("models/horse.json",function(a){var s=new THREE.Mesh(a,new THREE.MeshLambertMaterial({color:6316128,morphTargets:!0}));s.scale.set(.8,.8,.8),t&&s.position.setX(t),i&&s.position.setY(i),r&&s.position.setZ(r);var d=new THREE.Audio(listener);d.load("sounds/horse.mp3"),d.setRefDistance(20),d.autoplay=!0,s.add(d),_self.scene.add(s),n[e]=s;var l=new THREE.MorphAnimation(s);l.play(),o[e]=l})},this.addFlamingo=function(t,i,r,a){var s=new THREE.JSONLoader;s.load("models/flamingo.json ",function(s){e(s),s.computeMorphNormals();var d=new THREE.MeshLambertMaterial({color:16777215,morphTargets:!0,morphNormals:!0,vertexColors:THREE.FaceColors,shading:THREE.FlatShading}),l=new THREE.MorphAnimMesh(s,d);l.duration=5e3,l.scale.set(1,1,1),i&&l.position.setX(i),r&&l.position.setY(r),a&&l.position.setZ(a);var c=new THREE.Audio(listener);c.load("sounds/flamingo.mp3"),c.setRefDistance(20),c.autoplay=!0,l.add(c),_self.scene.add(l),n[t]=l,o[t]=l})},this.removeObject=function(e){if(e in n){var t=n[e];_self.scene.remove(t)}},this.moveObject=function(e,t,o,i){if(e in n){var r=n[e];r.position.setX(t),r.position.setY(o-r.geometry.boundingSphere.radius),r.position.setZ(i)}},this.rotateObject=function(e,t,o,i){if(e in n){var r=n[e];r.rotation.x=t,r.rotation.y=o,r.rotation.z=i}},this.animate=function(){requestAnimationFrame(_self.animate),t(),_self.stats&&_self.stats.update()},this.setupStats=function(){var e=new Stats;this.stats=e,e.setMode(0),e.domElement.style.position="absolute",e.domElement.style.left="0px",e.domElement.style.top="0px",document.body.appendChild(e.domElement)},this.stop=function(){i=!0},this.play=function(){i=!1}}function rotateRadian(e){return 0>e?e-Math.PI:e+Math.PI}function moveObject(e){if(e&&e.timeVisible>.25&&e.confidence>.7){var t=e.pitch(),n=-1*e.roll(),o=-1*e.yaw(),i={x:e.stabilizedPalmPosition[0],y:e.stabilizedPalmPosition[1],z:e.stabilizedPalmPosition[2]};drawer.moveObject(e.type,i.x,i.y,i.z),drawer.rotateObject(e.type,t,rotateRadian(o),n)}}Leap.Controller.plugin("leapExtras",function(){return{frame:{getLeftHand:function(){return $.grep(this.hands,function(e){return"left"===e.type})[0]},getRightHand:function(){return $.grep(this.hands,function(e){return"right"===e.type})[0]}}}});var drawer;$(document).ready(function(){drawer=new MarionetteDrawer,drawer.setup(),drawer.setupStats(),drawer.setBackground(),drawer.animate();var e=new Leap.Controller;e.use("screenPosition",{scale:.25}).use("handEntry").use("leapExtras").use("boneHand",{scene:drawer.scene,targetEl:document.body,arm:!1}),e.on("frame",function(e){moveObject(e.getLeftHand()),moveObject(e.getRightHand())}),e.on("handFound",function(e){var t=e.screenPosition();"left"===e.type?drawer.addHorse(e.type,t.x,t.y,t.z):"right"==e.type?drawer.addFlamingo(e.type,t.x,t.y,t.z):drawer.addCube(e.type)}),e.on("handLost",function(e){drawer.removeObject(e.type)}),e.connect()});