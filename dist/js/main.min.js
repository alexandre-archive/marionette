function MarionetteDrawer(){function e(e){m=e,T={},M={},f=new THREE.Scene,b=window.innerWidth,g=window.innerHeight;var o=75,t=b/g,n=.1,i=1e3;H=new THREE.PerspectiveCamera(o,t,n,i),f.add(H),H.position.y=0,H.position.x=0,H.position.z=400,H.target=new THREE.Vector3(0,150,0),H.lookAt(f.position),R=new THREE.WebGLRenderer({antialias:!0}),R.setClearColor(15790320),R.setPixelRatio(window.devicePixelRatio),R.setSize(b,g),m.appendChild(R.domElement);var a=new THREE.DirectionalLight(15724543,2);a.position.set(1,1,1).normalize(),f.add(a);var a=new THREE.DirectionalLight(16773103,2);a.position.set(-1,-1,-1).normalize(),f.add(a),p(),window.addEventListener("resize",h,!1)}function o(e){if(e in T){var o=T[e];f.remove(o)}}function t(e){var o=[];o.push(new THREE.MeshBasicMaterial({color:16724787})),o.push(new THREE.MeshBasicMaterial({color:16746496})),o.push(new THREE.MeshBasicMaterial({color:16777011})),o.push(new THREE.MeshBasicMaterial({color:3407667})),o.push(new THREE.MeshBasicMaterial({color:3355647})),o.push(new THREE.MeshBasicMaterial({color:8926207}));var t=new THREE.MeshFaceMaterial(o),n=new THREE.CubeGeometry(100,100,100,1,1,1);cube=new THREE.Mesh(n,t),cube.position.set(0,0,0),f.add(cube),T[e]=cube}function n(){var e=new THREE.ImageUtils.loadTexture("images/country.png"),o=new THREE.MeshBasicMaterial({map:e,side:THREE.DoubleSide}),t=new THREE.PlaneGeometry(2*b,2*g,10,10),n=new THREE.Mesh(t,o);n.position.z=-400,f.add(n)}function i(e){var o=new THREE.JSONLoader(!0);o.load("models//horse.json",function(o){var t=new THREE.Mesh(o,new THREE.MeshLambertMaterial({color:6316128,morphTargets:!0}));t.scale.set(.8,.8,.8),f.add(t),T[e]=t;var n=new THREE.MorphAnimation(t);n.play(),M[e]=n})}function a(e){var o=new THREE.JSONLoader;o.load("models/flamingo.json",function(o){r(o),o.computeMorphNormals();var t=new THREE.MeshLambertMaterial({color:16777215,morphTargets:!0,morphNormals:!0,vertexColors:THREE.FaceColors,shading:THREE.FlatShading}),n=new THREE.MorphAnimMesh(o,t);n.duration=5e3,n.scale.set(1,1,1),n.position.y=200,f.add(n),T[e]=n,M[e]=n,n.position.setY(240)})}function r(e){if(e.morphColors&&e.morphColors.length)for(var o=e.morphColors[0],t=0;t<o.colors.length;t++)e.faces[t].color=o.colors[t],e.faces[t].color.offsetHSL(0,.3,0)}function s(e,o,t,n){if(e in T){var i=T[e];i.position.setX(o),i.position.setY(t),i.position.setZ(n)}}function d(e,o,t,n){if(e in T){var i=T[e];i.rotation.x=c(o),i.rotation.y=c(t),i.rotation.z=c(n)}}function c(e){return e*Math.PI/180}function l(){requestAnimationFrame(l),E(),v.update()}function E(){if(M&&!j){var e=Date.now();for(obj in M)M[obj].update?M[obj].update(e-y):M[obj].updateAnimation(e-y);y=e}R.clear(),R.setViewport(0,0,b,g),R.render(f,H)}function p(){return v=new Stats,v.setMode(0),v.domElement.style.position="absolute",v.domElement.style.left="0px",v.domElement.style.top="0px",m.appendChild(v.domElement),v}function h(e){b=window.innerWidth,g=window.innerHeight,R.setSize(b,g),H.aspect=.5*b/g,H.updateProjectionMatrix()}function w(){j=!0}function u(){j=!1}this.init=e,this.addCube=t,this.animate=l,this.moveObject=s,this.rotateObject=d,this.addHorse=i,this.stop=w,this.play=u,this.addFlamingo=a,this.addScenario=n,this.removeObject=o;var m,f,H,R,v,T,M,b,g,y=(new THREE.Clock,Date.now()),j=!1}function moveObject(e){if(e&&e.timeVisible>.25&&e.confidence>.7){var o=e.pitchDegree(),t=e.rollDegree(),n=e.yawDegree(),i=e.get3JsScreenPosition();drawer.moveObject(e.type,i.x,i.y,i.z),drawer.rotateObject(e.type,-1*o,n,t)}}var drawer;$(document).ready(function(){drawer=new MarionetteDrawer,drawer.init(document.getElementById("container")),drawer.addScenario(),drawer.animate();var e=new Leap.Controller;e.use("screenPosition").use("handEntry").use("threejsPosition").use("leapExtras"),e.on("frame",function(e){moveObject(e.getLeftHand()),moveObject(e.getRightHand())}),e.on("handFound",function(e){"left"===e.type?drawer.addHorse(e.type):"right"==e.type?drawer.addFlamingo(e.type):drawer.addCube(e.type),drawer.moveObject(e.type)}),e.on("handLost",function(e){drawer.removeObject(e.type)}),e.connect()});